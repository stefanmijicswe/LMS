<div class="grading-container">
  <h2>Student Grading</h2>

  <mat-card style="margin-bottom: 20px; padding: 20px;">
    <mat-form-field appearance="outline" style="width: 100%;">
      <mat-label>Select Course</mat-label>
      <mat-select [(ngModel)]="selectedCourseId" (selectionChange)="onCourseSelected()">
        <mat-option [value]="null">-- Select a course --</mat-option>
        <mat-option *ngFor="let course of courses" [value]="course.subjectRealisationId">
          {{ course.subjectName }} ({{ course.studyProgrammeName }} - Year {{ course.yearNumber }})
        </mat-option>
      </mat-select>
    </mat-form-field>
  </mat-card>

  <div *ngIf="isLoadingCourses || isLoadingStudents" style="text-align: center; padding: 20px;">
    <mat-spinner diameter="40"></mat-spinner>
  </div>

  <div *ngIf="error" style="color: red; padding: 20px;">
    {{ error }}
  </div>

  <div *ngIf="!isLoadingCourses && !isLoadingStudents && !error">
    <div *ngIf="selectedCourseId && studentsDataSource.data.length === 0" style="text-align: center; padding: 20px;">
      No students found for this course.
    </div>

    <mat-table [dataSource]="studentsDataSource" class="grading-table" *ngIf="selectedCourseId && studentsDataSource.data.length > 0">
      <ng-container matColumnDef="studentName">
        <th mat-header-cell *matHeaderCellDef class="table-header">Student Name</th>
        <td mat-cell *matCellDef="let student">{{ student.studentName }} {{ student.studentSurname }}</td>
      </ng-container>

      <ng-container matColumnDef="subjectName">
        <th mat-header-cell *matHeaderCellDef class="table-header">Subject</th>
        <td mat-cell *matCellDef="let student">{{ student.subjectName }}</td>
      </ng-container>

      <ng-container matColumnDef="examinationPeriodName">
        <th mat-header-cell *matHeaderCellDef class="table-header">Exam Term</th>
        <td mat-cell *matCellDef="let student">{{ student.examinationPeriodName }}</td>
      </ng-container>

      <ng-container matColumnDef="evaluationTypeName">
        <th mat-header-cell *matHeaderCellDef class="table-header">Evaluation Type</th>
        <td mat-cell *matCellDef="let student">{{ student.evaluationTypeName }}</td>
      </ng-container>

      <ng-container matColumnDef="points">
        <th mat-header-cell *matHeaderCellDef class="table-header">Points</th>
        <td mat-cell *matCellDef="let student">{{ student.points !== null ? student.points : '-' }}</td>
      </ng-container>

      <ng-container matColumnDef="maxPoints">
        <th mat-header-cell *matHeaderCellDef class="table-header">Max Points</th>
        <td mat-cell *matCellDef="let student">{{ student.maxPoints }}</td>
      </ng-container>

      <ng-container matColumnDef="note">
        <th mat-header-cell *matHeaderCellDef class="table-header">Note</th>
        <td mat-cell *matCellDef="let student">{{ student.note || '-' }}</td>
      </ng-container>

      <ng-container matColumnDef="action">
        <th mat-header-cell *matHeaderCellDef></th>
        <td mat-cell *matCellDef="let student">
          <button mat-raised-button color="primary" (click)="openGradingDialog(student)">
            Grade
          </button>
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="displayedColumns" class="table-header-row"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns;" class="table-row"></tr>
    </mat-table>
  </div>
</div>
